# Bundle Analyzer æ•°æ®ç»“æ„å­—æ®µæ‰©å±•åˆ†æ

æœ¬æ–‡æ¡£åˆ†æäº†å››ä¸ªæ ¸å¿ƒæ•°æ®ç»“æ„ï¼ˆAssetã€Moduleã€Chunkã€Packageï¼‰çš„æ½œåœ¨å­—æ®µæ‰©å±•å»ºè®®ã€‚æ¯ä¸ªå»ºè®®éƒ½åŒ…å«å®ç°å¤æ‚åº¦ã€æ•°æ®é‡å½±å“ã€æ€§èƒ½å¼€é”€å’Œå¯å®ç°åŠŸèƒ½çš„è¯¦ç»†è¯„ä¼°ã€‚

## ä¼˜å…ˆçº§è¯´æ˜

- **é«˜ä¼˜å…ˆçº§ (High)**: æ˜¾è‘—æå‡åˆ†æèƒ½åŠ›ï¼Œå®ç°æˆæœ¬åˆç†
- **ä¸­ä¼˜å…ˆçº§ (Medium)**: æœ‰ä»·å€¼ä½†å®ç°æˆæœ¬è¾ƒé«˜ï¼Œæˆ–ä½¿ç”¨åœºæ™¯ç›¸å¯¹å—é™
- **ä½ä¼˜å…ˆçº§ (Low)**: ä»·å€¼è¾ƒå°æˆ–å®ç°æˆæœ¬è¿‡é«˜

---

## Asset ç»“æ„æ‰©å±•

### 1. asset_type: String â­ é«˜ä¼˜å…ˆçº§

#### å®ç°å¤æ‚åº¦
- **å¤æ‚åº¦**: ä½
- **å®ç°æ–¹å¼**: æ ¹æ®æ–‡ä»¶æ‰©å±•åæˆ– MIME ç±»å‹è¿›è¡Œåˆ†ç±»
- **ä»£ç é‡**: çº¦ 30-50 è¡Œï¼ˆæ·»åŠ ç±»å‹åˆ¤æ–­é€»è¾‘ï¼‰

```rust
pub enum AssetType {
  JavaScript,
  CSS,
  Image,
  Font,
  HTML,
  Other(String),
}
```

#### å¢åŠ çš„æ•°æ®é‡
- **æ¯ä¸ª Asset**: çº¦ 8-20 å­—èŠ‚ï¼ˆå­—ç¬¦ä¸²ï¼‰
- **å…¸å‹é¡¹ç›®** (50 ä¸ª assets): çº¦ 400 å­—èŠ‚ - 1KB
- **å¤§å‹é¡¹ç›®** (500 ä¸ª assets): çº¦ 4KB - 10KB
- **å¢é•¿ç‡**: å¯¹æ€»æ•°æ®é‡å½±å“ < 0.1%

#### æ€§èƒ½å¼€é”€
- **é‡‡é›†é˜¶æ®µ**: å‡ ä¹ä¸ºé›¶ï¼ˆç®€å•å­—ç¬¦ä¸²åŒ¹é…ï¼‰
- **å†…å­˜å¼€é”€**: å¯å¿½ç•¥ï¼ˆæ¯ä¸ª asset ä»…å¢åŠ ä¸€ä¸ªå­—æ®µï¼‰
- **ä¼ è¾“å¼€é”€**: å¯å¿½ç•¥ï¼ˆç›¸æ¯” asset å†…å®¹æœ¬èº«ï¼‰

#### å¯å®ç°åŠŸèƒ½åˆ—è¡¨
1. **èµ„æºç±»å‹ç»Ÿè®¡**: æŒ‰ç±»å‹åˆ†ç»„æ˜¾ç¤ºèµ„æºæ•°é‡å’Œå¤§å°
2. **ç±»å‹å æ¯”é¥¼å›¾**: å¯è§†åŒ–ä¸åŒç±»å‹èµ„æºçš„å¤§å°åˆ†å¸ƒ
3. **ç±»å‹ä¼˜åŒ–å»ºè®®**:
   - è¯†åˆ«è¿‡å¤§çš„å›¾ç‰‡èµ„æº
   - æ£€æµ‹æœªå‹ç¼©çš„ CSS/JS
   - å‘ç°æ„å¤–çš„èµ„æºç±»å‹
4. **ç»†ç²’åº¦è¿‡æ»¤**: å‰ç«¯å¯æŒ‰èµ„æºç±»å‹å¿«é€Ÿç­›é€‰
5. **æ€§èƒ½åˆ†æ**:
   - åˆ†æä¸åŒç±»å‹èµ„æºçš„åŠ è½½æ€§èƒ½
   - è¯†åˆ«é˜»å¡æ¸²æŸ“çš„èµ„æº
6. **ç¼“å­˜ç­–ç•¥å»ºè®®**: æ ¹æ®èµ„æºç±»å‹æ¨èç¼“å­˜ç­–ç•¥

---

### 2. brotli_size: Option<u32> ğŸ”¶ ä¸­ä¼˜å…ˆçº§

#### å®ç°å¤æ‚åº¦
- **å¤æ‚åº¦**: ä¸­ç­‰
- **å®ç°æ–¹å¼**: é›†æˆ Brotli å‹ç¼©åº“ï¼ˆç±»ä¼¼ç°æœ‰çš„ gzipï¼‰
- **ä»£ç é‡**: çº¦ 50-100 è¡Œï¼ˆå‚è€ƒ gzip å®ç°ï¼‰
- **ä¾èµ–**: éœ€æ·»åŠ  `brotli` crate

```rust
// å‚è€ƒç°æœ‰ gzip å®ç°
async fn calculate_brotli_size(content: &[u8]) -> Option<usize> {
  // Brotli å‹ç¼©å®ç°
}
```

#### å¢åŠ çš„æ•°æ®é‡
- **æ¯ä¸ª Asset**: 4 å­—èŠ‚ï¼ˆu32ï¼‰
- **å…¸å‹é¡¹ç›®** (50 ä¸ª assets): 200 å­—èŠ‚
- **å¤§å‹é¡¹ç›®** (500 ä¸ª assets): 2KB
- **å¢é•¿ç‡**: å¯¹æ€»æ•°æ®é‡å½±å“ < 0.05%

#### æ€§èƒ½å¼€é”€
- **é‡‡é›†é˜¶æ®µ**: ä¸­ç­‰
  - Brotli å‹ç¼©æ¯” gzip æ…¢ 2-3 å€
  - ä½†å¯ä»¥ä¸ gzip å¹¶è¡Œè®¡ç®—
  - å…¸å‹æ–‡ä»¶ï¼ˆ100KBï¼‰: çº¦ 50-150ms
- **å†…å­˜å¼€é”€**: ä¸ gzip ç›¸å½“ï¼ˆå‹ç¼©è¿‡ç¨‹éœ€è¦ä¸´æ—¶ç¼“å†²åŒºï¼‰
- **å»ºè®®**: è®¾ä¸ºå¯é€‰é…ç½®ï¼ˆé»˜è®¤å…³é—­ï¼‰

#### å¯å®ç°åŠŸèƒ½åˆ—è¡¨
1. **Brotli å‹ç¼©ç‡åˆ†æ**: å±•ç¤º Brotli å‹ç¼©åçš„æ€»å¤§å°
2. **å‹ç¼©ç®—æ³•å¯¹æ¯”**:
   - åŸå§‹ vs Gzip vs Brotli ä¸‰ç»´å¯¹æ¯”
   - å‹ç¼©ç‡å·®å¼‚å¯è§†åŒ–
3. **ç°ä»£æµè§ˆå™¨ä¼˜åŒ–**:
   - ä¼°ç®—æ”¯æŒ Brotli æµè§ˆå™¨çš„å®é™…ä¼ è¾“å¤§å°
   - è®¡ç®— Brotli å¸¦æ¥çš„é¢å¤–èŠ‚çœï¼ˆé€šå¸¸æ¯” gzip å° 15-20%ï¼‰
4. **CDN é…ç½®å»ºè®®**:
   - è¯†åˆ«å“ªäº› CDN æ”¯æŒ Brotli
   - æä¾› Brotli é…ç½®æŒ‡å—
5. **ROI åˆ†æ**:
   - è®¡ç®—å¯ç”¨ Brotli çš„å¸¦å®½èŠ‚çœ
   - è¯„ä¼°å‹ç¼©æ—¶é—´ vs å¸¦å®½èŠ‚çœçš„æƒè¡¡

---

## Module ç»“æ„æ‰©å±•

### 3. dependencies: Vec<String> â­ é«˜ä¼˜å…ˆçº§

#### å®ç°å¤æ‚åº¦
- **å¤æ‚åº¦**: ä¸­ç­‰
- **å®ç°æ–¹å¼**: ä» rspack çš„ `ModuleGraph` ä¸­æå–ä¾èµ–å…³ç³»
- **ä»£ç é‡**: çº¦ 100-150 è¡Œ
- **å…³é”® API**: `compilation.module_graph.dependencies(module)`

```rust
// ä¼ªä»£ç 
pub fn collect_dependencies(module: &Module, graph: &ModuleGraph) -> Vec<String> {
  graph.dependencies(module.id)
    .map(|dep| dep.module_id.clone())
    .collect()
}
```

#### å¢åŠ çš„æ•°æ®é‡
- **æ¯ä¸ª Module**: å–å†³äºä¾èµ–æ•°é‡
  - ç®€å•æ¨¡å—: 0-5 ä¸ªä¾èµ–ï¼Œçº¦ 20-100 å­—èŠ‚
  - å¸¸è§„æ¨¡å—: 5-20 ä¸ªä¾èµ–ï¼Œçº¦ 100-400 å­—èŠ‚
  - å¤æ‚æ¨¡å—: 20-50 ä¸ªä¾èµ–ï¼Œçº¦ 400-1000 å­—èŠ‚
- **å…¸å‹é¡¹ç›®** (1000 ä¸ªæ¨¡å—ï¼Œå¹³å‡ 10 ä¸ªä¾èµ–): çº¦ 200KB
- **å¤§å‹é¡¹ç›®** (10000 ä¸ªæ¨¡å—): çº¦ 2MB
- **å¢é•¿ç‡**: å¯¹æ€»æ•°æ®é‡å¢åŠ çº¦ 5-15%

#### æ€§èƒ½å¼€é”€
- **é‡‡é›†é˜¶æ®µ**: ä½åˆ°ä¸­ç­‰
  - éœ€è¦éå† ModuleGraph
  - æ—¶é—´å¤æ‚åº¦: O(n * m)ï¼Œn = æ¨¡å—æ•°ï¼Œm = å¹³å‡ä¾èµ–æ•°
  - å…¸å‹é¡¹ç›®: çº¦ 10-50ms
  - å¤§å‹é¡¹ç›®: çº¦ 100-300ms
- **å†…å­˜å¼€é”€**: ä¸­ç­‰ï¼ˆéœ€è¦å­˜å‚¨æ‰€æœ‰ä¾èµ–å…³ç³»ï¼‰
- **ä¼ è¾“å¼€é”€**: ä¸­ç­‰ï¼ˆæ•°æ®é‡å¢åŠ  5-15%ï¼‰

#### å¯å®ç°åŠŸèƒ½åˆ—è¡¨
1. **ä¾èµ–å…³ç³»å›¾å¯è§†åŒ–**:
   - äº¤äº’å¼ä¾èµ–å›¾
   - æ¨¡å—é—´å…³ç³»æ¢ç´¢
   - ä¾èµ–è·¯å¾„é«˜äº®
2. **å…³é”®æ¨¡å—è¯†åˆ«**:
   - æ‰¾å‡ºè¢«ä¾èµ–æœ€å¤šçš„æ¨¡å—
   - è®¡ç®—æ¨¡å—çš„"ä¸­å¿ƒåº¦"
3. **å¾ªç¯ä¾èµ–æ£€æµ‹**:
   - è‡ªåŠ¨è¯†åˆ«å¾ªç¯å¼•ç”¨
   - å±•ç¤ºå¾ªç¯ä¾èµ–é“¾
4. **å½±å“åˆ†æ**:
   - è¯„ä¼°ä¿®æ”¹æŸæ¨¡å—çš„å½±å“èŒƒå›´
   - ä¾èµ–é“¾æ·±åº¦åˆ†æ
5. **Tree Shaking åˆ†æ**:
   - è¯†åˆ«æœªä½¿ç”¨çš„ä¾èµ–
   - è¯„ä¼° Tree Shaking æ•ˆæœ
6. **é‡æ„è¾…åŠ©**:
   - è¯†åˆ«é«˜è€¦åˆæ¨¡å—
   - æä¾›è§£è€¦å»ºè®®
7. **å¯¼å…¥è·¯å¾„ä¼˜åŒ–**:
   - æ£€æµ‹ä¸å¿…è¦çš„é—´æ¥ä¾èµ–
   - å»ºè®®æ›´çŸ­çš„å¯¼å…¥è·¯å¾„

---

### 4. dependents: Vec<String> â­ é«˜ä¼˜å…ˆçº§

#### å®ç°å¤æ‚åº¦
- **å¤æ‚åº¦**: ä¸­ç­‰
- **å®ç°æ–¹å¼**: æ„å»ºä¾èµ–çš„åå‘ç´¢å¼•
- **ä»£ç é‡**: çº¦ 50-80 è¡Œï¼ˆåœ¨æ”¶é›† dependencies æ—¶åŒæ—¶ç”Ÿæˆï¼‰
- **ä¼˜åŒ–**: å¯ä»¥ä¸ dependencies ä¸€æ¬¡æ€§æ„å»ºï¼Œæ— éœ€äºŒæ¬¡éå†

```rust
// ä¼ªä»£ç 
pub fn build_dependency_graph(modules: &[Module]) -> (DependencyMap, DependentMap) {
  let mut dependencies = HashMap::new();
  let mut dependents = HashMap::new();

  for module in modules {
    for dep in &module.dependencies {
      dependencies.entry(module.id).or_default().push(dep.clone());
      dependents.entry(dep).or_default().push(module.id.clone());
    }
  }

  (dependencies, dependents)
}
```

#### å¢åŠ çš„æ•°æ®é‡
- **æ•°æ®é‡**: ä¸ dependencies ç›¸åŒ
- **å…¸å‹é¡¹ç›®**: çº¦ 200KB
- **å¤§å‹é¡¹ç›®**: çº¦ 2MB
- **å¢é•¿ç‡**: é¢å¤–å¢åŠ  5-15%ï¼ˆå¦‚æœåŒæ—¶æ·»åŠ  dependencies å’Œ dependentsï¼Œæ€»å¢é•¿çº¦ 10-30%ï¼‰

#### æ€§èƒ½å¼€é”€
- **é‡‡é›†é˜¶æ®µ**: å‡ ä¹ä¸ºé›¶
  - å¦‚æœåœ¨æ„å»º dependencies æ—¶åŒæ—¶ç”Ÿæˆï¼Œæ— é¢å¤–å¼€é”€
  - åªæ˜¯åå‘ç´¢å¼•æ„å»ºï¼ŒO(n * m) å¤æ‚åº¦å·²åŒ…å«åœ¨ dependencies æ”¶é›†ä¸­
- **å†…å­˜å¼€é”€**: ä¸ dependencies ç›¸å½“
- **ä¼ è¾“å¼€é”€**: ä¸ dependencies ç›¸åŒ

#### å¯å®ç°åŠŸèƒ½åˆ—è¡¨
1. **å½±å“èŒƒå›´å¯è§†åŒ–**:
   - æ˜¾ç¤ºä¿®æ”¹æŸæ¨¡å—ä¼šå½±å“å“ªäº›æ¨¡å—
   - ä¾èµ–æ‰‡å‡ºåˆ†æ
2. **å…³é”®æ¨¡å—è¯†åˆ«**:
   - è¯†åˆ«"åŸºç¡€æ¨¡å—"ï¼ˆè¢«å¾ˆå¤šæ¨¡å—ä¾èµ–ï¼‰
   - æ¨¡å—é‡è¦æ€§è¯„åˆ†
3. **é‡æ„é£é™©è¯„ä¼°**:
   - è¯„ä¼°é‡æ„æŸæ¨¡å—çš„é£é™©çº§åˆ«
   - è®¡ç®—å½±å“çš„æ¨¡å—æ•°é‡
4. **æœªä½¿ç”¨æ¨¡å—æ£€æµ‹**:
   - æ‰¾å‡ºæ²¡æœ‰ dependents çš„æ¨¡å—ï¼ˆé™¤äº†å…¥å£ï¼‰
   - è¯†åˆ« Dead Code
5. **æ¨¡å—å¥åº·åº¦åˆ†æ**:
   - è¿‡å¤š dependents = å¯èƒ½éœ€è¦æ‹†åˆ†
   - é›¶ dependents = å¯èƒ½æ˜¯æ­»ä»£ç 
6. **ä¾èµ–è§£è€¦å»ºè®®**:
   - è¯†åˆ«è¿‡åº¦è¢«ä¾èµ–çš„æ¨¡å—
   - æä¾›æ¥å£æŠ½è±¡å»ºè®®
7. **å˜æ›´å½±å“è¯„ä¼°**:
   - CI/CD ä¸­è¯„ä¼°å˜æ›´å½±å“èŒƒå›´
   - æ™ºèƒ½æµ‹è¯•é€‰æ‹©

---

### 5. depth: u32 ğŸ”¶ ä¸­ä¼˜å…ˆçº§

#### å®ç°å¤æ‚åº¦
- **å¤æ‚åº¦**: ä¸­ç­‰
- **å®ç°æ–¹å¼**: ä»å…¥å£æ¨¡å—å¼€å§‹è¿›è¡Œ BFS éå†ï¼Œè®¡ç®—æ¯ä¸ªæ¨¡å—çš„æœ€çŸ­è·¯å¾„æ·±åº¦
- **ä»£ç é‡**: çº¦ 80-120 è¡Œ
- **ç®—æ³•**: å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼ˆBFSï¼‰

```rust
// ä¼ªä»£ç 
pub fn calculate_depths(entry_modules: &[String], graph: &DependencyGraph) -> HashMap<String, u32> {
  let mut depths = HashMap::new();
  let mut queue = VecDeque::new();

  // åˆå§‹åŒ–å…¥å£æ¨¡å—æ·±åº¦ä¸º 0
  for entry in entry_modules {
    depths.insert(entry.clone(), 0);
    queue.push_back((entry.clone(), 0));
  }

  // BFS éå†
  while let Some((module_id, depth)) = queue.pop_front() {
    for dep in graph.dependencies(&module_id) {
      depths.entry(dep.clone()).or_insert_with(|| {
        queue.push_back((dep.clone(), depth + 1));
        depth + 1
      });
    }
  }

  depths
}
```

#### å¢åŠ çš„æ•°æ®é‡
- **æ¯ä¸ª Module**: 4 å­—èŠ‚ï¼ˆu32ï¼‰
- **å…¸å‹é¡¹ç›®** (1000 ä¸ªæ¨¡å—): 4KB
- **å¤§å‹é¡¹ç›®** (10000 ä¸ªæ¨¡å—): 40KB
- **å¢é•¿ç‡**: å¯¹æ€»æ•°æ®é‡å½±å“ < 1%

#### æ€§èƒ½å¼€é”€
- **é‡‡é›†é˜¶æ®µ**: ä½åˆ°ä¸­ç­‰
  - éœ€è¦ BFS éå†ä¾èµ–å›¾
  - æ—¶é—´å¤æ‚åº¦: O(V + E)ï¼ŒV = æ¨¡å—æ•°ï¼ŒE = ä¾èµ–è¾¹æ•°
  - å…¸å‹é¡¹ç›®: çº¦ 5-20ms
  - å¤§å‹é¡¹ç›®: çº¦ 50-150ms
- **å†…å­˜å¼€é”€**: ä½ï¼ˆä»…éœ€è¦é˜Ÿåˆ—å’Œæ·±åº¦æ˜ å°„ï¼‰
- **ä¾èµ–**: å¿…é¡»å…ˆå®ç° dependencies å­—æ®µ

#### å¯å®ç°åŠŸèƒ½åˆ—è¡¨
1. **ä¾èµ–æ·±åº¦å¯è§†åŒ–**:
   - æŒ‰æ·±åº¦åˆ†å±‚å±•ç¤ºæ¨¡å—
   - ä¾èµ–æ ‘å±‚çº§è§†å›¾
2. **æ€§èƒ½ä¼˜åŒ–å»ºè®®**:
   - è¯†åˆ«æ·±å±‚ä¾èµ–ï¼ˆå¯èƒ½å½±å“åŠ è½½æ—¶é—´ï¼‰
   - å»ºè®®æå‡å¸¸ç”¨æ¨¡å—çš„å±‚çº§
3. **ä»£ç æ‹†åˆ†ä¼˜åŒ–**:
   - æ·±å±‚æ¨¡å—é€‚åˆå¼‚æ­¥åŠ è½½
   - æµ…å±‚æ¨¡å—åº”åŒ…å«åœ¨ä¸» bundle
4. **å…³é”®è·¯å¾„åˆ†æ**:
   - è¯†åˆ«ä»å…¥å£åˆ°æ ¸å¿ƒåŠŸèƒ½çš„æœ€çŸ­è·¯å¾„
   - ä¼˜åŒ–å…³é”®è·¯å¾„ä¸Šçš„æ¨¡å—
5. **æ‡’åŠ è½½å€™é€‰è¯†åˆ«**:
   - depth > 3 çš„æ¨¡å—é€‚åˆæ‡’åŠ è½½
   - è‡ªåŠ¨ç”Ÿæˆæ‡’åŠ è½½å»ºè®®
6. **æ¶æ„å¥åº·åº¦è¯„ä¼°**:
   - è¿‡æ·±çš„ä¾èµ–æ ‘ = å¯èƒ½çš„æ¶æ„é—®é¢˜
   - å»ºè®®æ¶æ„æ‰å¹³åŒ–
7. **æ¨¡å—åˆ†å±‚ç­–ç•¥**:
   - è‡ªåŠ¨åˆ’åˆ†æ ¸å¿ƒå±‚/ä¸šåŠ¡å±‚/å·¥å…·å±‚
   - è¾…åŠ©å»ºç«‹æ¸…æ™°çš„åˆ†å±‚æ¶æ„

---

## Chunk ç»“æ„æ‰©å±•

### 6. parents: Vec<String> ğŸ”¶ ä¸­ä¼˜å…ˆçº§

#### å®ç°å¤æ‚åº¦
- **å¤æ‚åº¦**: ä½åˆ°ä¸­ç­‰
- **å®ç°æ–¹å¼**: ä» rspack çš„ `ChunkGroup` ä¸­æå–çˆ¶ chunk å…³ç³»
- **ä»£ç é‡**: çº¦ 40-70 è¡Œ
- **å…³é”® API**: `chunk_group.parents` æˆ–é€šè¿‡ `chunk_graph` éå†

```rust
// ä¼ªä»£ç 
pub fn collect_parent_chunks(chunk: &Chunk, compilation: &Compilation) -> Vec<String> {
  let chunk_graph = &compilation.chunk_graph;
  chunk_graph.get_chunk_entry_dependent_chunks_iterable(&chunk.ukey)
    .map(|parent| parent.id.clone())
    .collect()
}
```

#### å¢åŠ çš„æ•°æ®é‡
- **æ¯ä¸ª Chunk**: å–å†³äº chunk å±‚çº§ç»“æ„
  - å…¥å£ chunk: 0 ä¸ª parentsï¼Œ0 å­—èŠ‚
  - å¼‚æ­¥ chunk: 1-3 ä¸ª parentsï¼Œçº¦ 20-60 å­—èŠ‚
  - æ·±å±‚å¼‚æ­¥ chunk: å¯èƒ½æ›´å¤š
- **å…¸å‹é¡¹ç›®** (20 ä¸ª chunksï¼Œå¹³å‡ 1 ä¸ª parent): çº¦ 400 å­—èŠ‚
- **å¤§å‹é¡¹ç›®** (200 ä¸ª chunks): çº¦ 4KB
- **å¢é•¿ç‡**: å¯¹æ€»æ•°æ®é‡å½±å“ < 0.5%

#### æ€§èƒ½å¼€é”€
- **é‡‡é›†é˜¶æ®µ**: ä½
  - rspack å†…éƒ¨å·²ç»´æŠ¤ chunk ä¾èµ–å…³ç³»
  - ä»…éœ€è¯»å–ç°æœ‰æ•°æ®ç»“æ„
  - æ—¶é—´å¤æ‚åº¦: O(n)ï¼Œn = chunk æ•°é‡
  - å…¸å‹å¼€é”€: < 5ms
- **å†…å­˜å¼€é”€**: ä½
- **ä¼ è¾“å¼€é”€**: å¯å¿½ç•¥

#### å¯å®ç°åŠŸèƒ½åˆ—è¡¨
1. **Chunk ä¾èµ–å›¾**:
   - å¯è§†åŒ– chunk åŠ è½½é¡ºåº
   - å±•ç¤º chunk å±‚çº§å…³ç³»
2. **åŠ è½½é¡ºåºä¼˜åŒ–**:
   - è¯†åˆ«å…³é”® chunk è·¯å¾„
   - ä¼˜åŒ– preload/prefetch ç­–ç•¥
3. **Chunk æ‹†åˆ†åˆ†æ**:
   - è¯„ä¼°å½“å‰ chunk æ‹†åˆ†ç­–ç•¥
   - è¯†åˆ«ä¸åˆç†çš„ chunk ä¾èµ–
4. **æ€§èƒ½ç“¶é¢ˆè¯†åˆ«**:
   - æ‰¾å‡ºåŠ è½½é“¾è¿‡é•¿çš„ chunk
   - å»ºè®®åˆå¹¶æŸäº› parent-child chunk
5. **å¹¶è¡ŒåŠ è½½ä¼˜åŒ–**:
   - è¯†åˆ«å¯ä»¥å¹¶è¡ŒåŠ è½½çš„ chunk
   - ä¼˜åŒ– chunk ä¾èµ–ç»“æ„
6. **ä»£ç æ‹†åˆ†ç­–ç•¥**:
   - åŸºäºä¾èµ–å…³ç³»è°ƒæ•´æ‹†åˆ†ç²’åº¦
   - é¿å…è¿‡åº¦æ‹†åˆ†å¯¼è‡´çš„è¯·æ±‚æ•°æ¿€å¢

---

### 7. children: Vec<String> ğŸ”¶ ä¸­ä¼˜å…ˆçº§

#### å®ç°å¤æ‚åº¦
- **å¤æ‚åº¦**: ä½åˆ°ä¸­ç­‰
- **å®ç°æ–¹å¼**: ä¸ parents åŒæ—¶ä» rspack æå–
- **ä»£ç é‡**: çº¦ 40-70 è¡Œï¼ˆé€šå¸¸ä¸ parents ä¸€èµ·å®ç°ï¼‰

```rust
// ä¼ªä»£ç 
pub fn collect_child_chunks(chunk: &Chunk, compilation: &Compilation) -> Vec<String> {
  let chunk_graph = &compilation.chunk_graph;
  chunk.get_all_async_chunks()
    .iter()
    .map(|child| child.id.clone())
    .collect()
}
```

#### å¢åŠ çš„æ•°æ®é‡
- **æ¯ä¸ª Chunk**:
  - å¶å­ chunkï¼ˆæ— å¼‚æ­¥å¯¼å…¥ï¼‰: 0 ä¸ª childrenï¼Œ0 å­—èŠ‚
  - åŒ…å«å¼‚æ­¥å¯¼å…¥çš„ chunk: 1-10 ä¸ª childrenï¼Œçº¦ 20-200 å­—èŠ‚
  - è·¯ç”± chunkï¼ˆå¤§é‡æ‡’åŠ è½½ï¼‰: å¯èƒ½ 10+ ä¸ª children
- **å…¸å‹é¡¹ç›®** (20 ä¸ª chunksï¼Œå¹³å‡ 2 ä¸ª children): çº¦ 800 å­—èŠ‚
- **å¤§å‹é¡¹ç›®** (200 ä¸ª chunks): çº¦ 8KB
- **å¢é•¿ç‡**: å¯¹æ€»æ•°æ®é‡å½±å“ < 0.5%

#### æ€§èƒ½å¼€é”€
- **é‡‡é›†é˜¶æ®µ**: ä½
  - ä¸ parents ä¸€èµ·æ”¶é›†ï¼Œå‡ ä¹æ— é¢å¤–å¼€é”€
  - æ—¶é—´å¤æ‚åº¦: O(n)
  - å…¸å‹å¼€é”€: < 5ms
- **å†…å­˜å¼€é”€**: ä½
- **ä¼ è¾“å¼€é”€**: å¯å¿½ç•¥

#### å¯å®ç°åŠŸèƒ½åˆ—è¡¨
1. **å¼‚æ­¥åŠ è½½åˆ†æ**:
   - è¯†åˆ«æ‰€æœ‰å¼‚æ­¥å­æ¨¡å—
   - è¯„ä¼°ä»£ç æ‹†åˆ†æ•ˆæœ
2. **æ‡’åŠ è½½å¯è§†åŒ–**:
   - å±•ç¤ºåŠ¨æ€ import() äº§ç”Ÿçš„ chunk
   - è·¯ç”±æ‡’åŠ è½½å…³ç³»å›¾
3. **Bundle ä¼˜åŒ–å»ºè®®**:
   - è¯†åˆ«è¿‡åº¦æ‹†åˆ†çš„æƒ…å†µ
   - å»ºè®®åˆå¹¶å°å‹å¼‚æ­¥ chunk
4. **åŠ è½½æ€§èƒ½ä¼˜åŒ–**:
   - è¯„ä¼°å¼‚æ­¥ chunk çš„åŠ è½½æ—¶æœº
   - å»ºè®® prefetch ä¼˜å…ˆçº§
5. **ä»£ç æ‹†åˆ†æ•ˆæœè¯„ä¼°**:
   - ç»Ÿè®¡é¦–å± vs å¼‚æ­¥ä»£ç æ¯”ä¾‹
   - è¯„ä¼°æ‹†åˆ†ç²’åº¦æ˜¯å¦åˆç†
6. **è·¯ç”±çº§åˆ«åˆ†æ**:
   - è¯†åˆ«æ¯ä¸ªè·¯ç”±å¯¹åº”çš„ chunk æ ‘
   - ä¼˜åŒ–è·¯ç”±çº§åˆ«çš„ä»£ç æ‹†åˆ†

---

## Package ç»“æ„æ‰©å±•

### 8. chunks: Vec<String> â­ é«˜ä¼˜å…ˆçº§

#### å®ç°å¤æ‚åº¦
- **å¤æ‚åº¦**: ä½
- **å®ç°æ–¹å¼**: åœ¨æ”¶é›† modules æ—¶è®°å½•æ¯ä¸ª package å‡ºç°åœ¨å“ªäº› chunks ä¸­
- **ä»£ç é‡**: çº¦ 30-50 è¡Œï¼ˆä¿®æ”¹ç°æœ‰ Package æ”¶é›†é€»è¾‘ï¼‰

```rust
// ä¼ªä»£ç 
impl Packages {
  pub fn from_with_resolver(modules: &Modules, resolver: &mut Resolver) -> Self {
    let mut package_map: HashMap<String, PackageData> = HashMap::new();

    for module in modules {
      if let Some(pkg) = extract_package_name(&module.name) {
        let entry = package_map.entry(pkg).or_default();
        entry.modules.push(module.id.clone());
        // æ–°å¢ï¼šè®°å½• chunks
        entry.chunks.extend(module.chunks.clone());
      }
    }

    // å»é‡ chunks
    for (_, data) in &mut package_map {
      data.chunks.sort();
      data.chunks.dedup();
    }

    // ...
  }
}
```

#### å¢åŠ çš„æ•°æ®é‡
- **æ¯ä¸ª Package**: å–å†³äºåŒ…çš„åˆ†å¸ƒ
  - å• chunk åŒ…ï¼ˆç†æƒ³æƒ…å†µï¼‰: 1 ä¸ª chunk IDï¼Œçº¦ 20 å­—èŠ‚
  - è·¨ chunk åŒ…: 2-5 ä¸ª chunk IDsï¼Œçº¦ 40-100 å­—èŠ‚
  - å¹¿æ³›ä½¿ç”¨çš„åŒ…ï¼ˆå¦‚ lodashï¼‰: å¯èƒ½ 10+ chunks
- **å…¸å‹é¡¹ç›®** (100 ä¸ª packagesï¼Œå¹³å‡ 1.5 ä¸ª chunks): çº¦ 3KB
- **å¤§å‹é¡¹ç›®** (500 ä¸ª packages): çº¦ 15KB
- **å¢é•¿ç‡**: å¯¹æ€»æ•°æ®é‡å½±å“ < 2%

#### æ€§èƒ½å¼€é”€
- **é‡‡é›†é˜¶æ®µ**: å‡ ä¹ä¸ºé›¶
  - ä»…åœ¨ç°æœ‰çš„æ¨¡å—éå†ä¸­æ·»åŠ è®°å½•
  - é¢å¤–æ“ä½œ: å»é‡æ’åºï¼ˆO(k log k)ï¼Œk = chunk æ•°é‡ï¼Œé€šå¸¸ < 10ï¼‰
  - å…¸å‹å¼€é”€: < 5ms
- **å†…å­˜å¼€é”€**: ä½
- **ä¼ è¾“å¼€é”€**: ä½

#### å¯å®ç°åŠŸèƒ½åˆ—è¡¨
1. **ä»£ç é‡å¤æ£€æµ‹**: â­ æ ¸å¿ƒåŠŸèƒ½
   - è¯†åˆ«åœ¨å¤šä¸ª chunk ä¸­é‡å¤æ‰“åŒ…çš„åŒ…
   - è®¡ç®—é‡å¤ä»£ç é€ æˆçš„é¢å¤–ä½“ç§¯
2. **Vendor Chunk ä¼˜åŒ–**:
   - åˆ†æå“ªäº›åŒ…åº”è¯¥æå–åˆ°å…±äº« vendor chunk
   - å»ºè®® splitChunks é…ç½®
3. **åŒ…åˆ†å¸ƒå¯è§†åŒ–**:
   - å±•ç¤ºæ¯ä¸ªåŒ…åœ¨å“ªäº› chunk ä¸­å‡ºç°
   - çƒ­åŠ›å›¾æ˜¾ç¤ºåŒ…çš„å…±äº«ç¨‹åº¦
4. **ä»£ç å…±äº«ä¼˜åŒ–**:
   - è¯†åˆ«å¯ä»¥è¿›ä¸€æ­¥å…±äº«çš„åŒ…
   - ä¼˜åŒ– chunk æ‹†åˆ†ç­–ç•¥å‡å°‘é‡å¤
5. **ä½“ç§¯å½’å› åˆ†æ**:
   - æŒ‰ chunk è¿½æº¯åŒ…çš„ä½“ç§¯å æ¯”
   - è¯†åˆ«å¯¼è‡´æŸä¸ª chunk è¿‡å¤§çš„åŒ…
6. **æ„å»ºé…ç½®å»ºè®®**:
   - åŸºäºåŒ…åˆ†å¸ƒè‡ªåŠ¨ç”Ÿæˆ splitChunks é…ç½®
   - ä¼˜åŒ– cacheGroups è®¾ç½®
7. **ä¾èµ–ç‰ˆæœ¬ä¸€è‡´æ€§**:
   - ç»“åˆ chunk åˆ†å¸ƒæ£€æŸ¥åŒä¸€åŒ…çš„ä¸åŒç‰ˆæœ¬
   - è¯†åˆ«å¯èƒ½çš„é‡å¤ä¾èµ–é—®é¢˜

---

### 9. license: String ğŸ”· ä½ä¼˜å…ˆçº§

#### å®ç°å¤æ‚åº¦
- **å¤æ‚åº¦**: ä¸­ç­‰
- **å®ç°æ–¹å¼**: è¯»å–å¹¶è§£æ package.json çš„ license å­—æ®µ
- **ä»£ç é‡**: çº¦ 60-100 è¡Œ
- **æŒ‘æˆ˜**:
  - éœ€è¦è®¿é—®æ–‡ä»¶ç³»ç»Ÿè¯»å– package.json
  - license å­—æ®µæ ¼å¼ä¸ç»Ÿä¸€ï¼ˆå­—ç¬¦ä¸² / å¯¹è±¡ / æ•°ç»„ï¼‰
  - éœ€è¦ç¼“å­˜é¿å…é‡å¤è¯»å–

```rust
// ä¼ªä»£ç 
async fn extract_license(package_json_path: &str) -> Option<String> {
  let content = fs::read_to_string(package_json_path).await.ok()?;
  let json: serde_json::Value = serde_json::from_str(&content).ok()?;

  // å¤„ç†å¤šç§ license æ ¼å¼
  match &json["license"] {
    serde_json::Value::String(s) => Some(s.clone()),
    serde_json::Value::Object(obj) => obj.get("type").and_then(|v| v.as_str()).map(String::from),
    _ => None,
  }
}
```

#### å¢åŠ çš„æ•°æ®é‡
- **æ¯ä¸ª Package**: çº¦ 5-30 å­—èŠ‚ï¼ˆlicense å­—ç¬¦ä¸²ï¼‰
  - å¸¸è§ license: "MIT" (3), "Apache-2.0" (10), "BSD-3-Clause" (13)
- **å…¸å‹é¡¹ç›®** (100 ä¸ª packages): çº¦ 1-2KB
- **å¤§å‹é¡¹ç›®** (500 ä¸ª packages): çº¦ 5-10KB
- **å¢é•¿ç‡**: å¯¹æ€»æ•°æ®é‡å½±å“ < 1%

#### æ€§èƒ½å¼€é”€
- **é‡‡é›†é˜¶æ®µ**: ä¸­ç­‰
  - éœ€è¦è¯»å–æ¯ä¸ªåŒ…çš„ package.json æ–‡ä»¶
  - å¦‚æœå·²åœ¨å†…å­˜ä¸­ï¼ˆpackage version è§£ææ—¶è¯»å–ï¼‰: ä½å¼€é”€
  - å¦‚æœéœ€è¦é¢å¤–è¯»å–: æ¯ä¸ªæ–‡ä»¶çº¦ 1-5ms
  - å…¸å‹é¡¹ç›®: çº¦ 100-500ms
  - å¤§å‹é¡¹ç›®: çº¦ 500ms - 2s
- **ä¼˜åŒ–æ–¹æ¡ˆ**:
  - ä¸ package version è§£æå…±äº«æ–‡ä»¶è¯»å–
  - æ·»åŠ é…ç½®å¼€å…³ï¼ˆé»˜è®¤å…³é—­ï¼‰
- **å†…å­˜å¼€é”€**: ä½
- **ä¼ è¾“å¼€é”€**: å¯å¿½ç•¥

#### å¯å®ç°åŠŸèƒ½åˆ—è¡¨
1. **è®¸å¯è¯æŠ¥å‘Šç”Ÿæˆ**:
   - è‡ªåŠ¨ç”Ÿæˆé¡¹ç›®çš„å¼€æºè®¸å¯è¯æ¸…å•
   - å¯¼å‡ºä¸ºå¤šç§æ ¼å¼ï¼ˆJSON/Markdown/HTMLï¼‰
2. **è®¸å¯è¯åˆè§„æ£€æŸ¥**:
   - è¯†åˆ«ä¸å…¼å®¹çš„è®¸å¯è¯ç»„åˆ
   - æ£€æµ‹å•†ä¸šä½¿ç”¨é™åˆ¶çš„è®¸å¯è¯
3. **è®¸å¯è¯é£é™©è¯„ä¼°**:
   - æ ‡è®°é«˜é£é™©è®¸å¯è¯ï¼ˆå¦‚ GPL/AGPLï¼‰
   - è¯†åˆ«æ— è®¸å¯è¯çš„åŒ…
4. **æ³•å¾‹å®¡è®¡æ”¯æŒ**:
   - ä¼ä¸šåˆè§„æ€§æ£€æŸ¥
   - å¼€æºå®¡è®¡æŠ¥å‘Š
5. **è®¸å¯è¯ç»Ÿè®¡**:
   - æŒ‰è®¸å¯è¯ç±»å‹ç»Ÿè®¡åŒ…æ•°é‡
   - å¯è§†åŒ–è®¸å¯è¯åˆ†å¸ƒ
6. **ä¾èµ–é€‰æ‹©å»ºè®®**:
   - åŸºäºè®¸å¯è¯æ¨èæ›¿ä»£åŒ…
   - é¿å…ä½¿ç”¨å—é™è®¸å¯è¯çš„åŒ…

---

## ç»¼åˆå»ºè®®

### å®æ–½ä¼˜å…ˆçº§

#### ç¬¬ä¸€é˜¶æ®µï¼ˆé«˜ä»·å€¼ä½æˆæœ¬ï¼‰
1. **Module.dependencies + dependents** - è§£é”ä¾èµ–åˆ†æèƒ½åŠ›çš„åŸºç¡€
2. **Package.chunks** - è¯†åˆ«ä»£ç é‡å¤ï¼Œä¼˜åŒ– bundle æ‹†åˆ†
3. **Asset.asset_type** - èµ„æºç±»å‹ç»Ÿè®¡å’Œä¼˜åŒ–

#### ç¬¬äºŒé˜¶æ®µï¼ˆé«˜ä»·å€¼ä¸­ç­‰æˆæœ¬ï¼‰
4. **Module.depth** - ä¾èµ–å‰æ: dependencies å·²å®ç°
5. **Chunk.parents + children** - å®Œå–„ chunk ä¾èµ–åˆ†æ

#### ç¬¬ä¸‰é˜¶æ®µï¼ˆç‰¹å®šåœºæ™¯ï¼‰
6. **Asset.brotli_size** - é€‚åˆå¯¹ä¼ è¾“å¤§å°æ•æ„Ÿçš„é¡¹ç›®
7. **Package.license** - é€‚åˆä¼ä¸šåˆè§„æ€§è¦æ±‚é«˜çš„é¡¹ç›®

### æ€§èƒ½å½±å“æ€»ç»“

| å­—æ®µ | é‡‡é›†å¼€é”€ | æ•°æ®å¢é•¿ | ä¼ è¾“å½±å“ |
|------|---------|---------|---------|
| Asset.asset_type | ~0ms | < 0.1% | ä½ |
| Asset.brotli_size | 50-150ms/æ–‡ä»¶ | < 0.1% | ä½ |
| Module.dependencies | 10-300ms | 5-15% | ä¸­ |
| Module.dependents | ~0ms (ä¸ deps å…±äº«) | 5-15% | ä¸­ |
| Module.depth | 5-150ms | < 1% | ä½ |
| Chunk.parents | < 5ms | < 0.5% | ä½ |
| Chunk.children | < 5ms | < 0.5% | ä½ |
| Package.chunks | < 5ms | < 2% | ä½ |
| Package.license | 100ms - 2s | < 1% | ä½ |

### æ€»ä½“å»ºè®®

1. **ä¼˜å…ˆå®ç° Module ä¾èµ–å…³ç³»**ï¼ˆdependencies + dependentsï¼‰
   - è¿™æ˜¯æœ€æ ¸å¿ƒçš„åŠŸèƒ½ï¼Œè§£é”å¤§é‡é«˜çº§åˆ†æèƒ½åŠ›
   - è™½ç„¶æ•°æ®é‡å¢åŠ è¾ƒå¤šï¼Œä½†ä»·å€¼è¿œè¶…æˆæœ¬

2. **Package.chunks ç®€å•é«˜æ•ˆ**
   - å®ç°æˆæœ¬ä½ï¼Œç«‹å³è§£å†³ä»£ç é‡å¤é—®é¢˜
   - å»ºè®®ä¼˜å…ˆå®æ–½

3. **Asset.asset_type å¿«é€Ÿè§æ•ˆ**
   - å®ç°ç®€å•ï¼Œç«‹å³æå‡ç”¨æˆ·ä½“éªŒ
   - å»ºè®®åœ¨ç¬¬ä¸€æ‰¹å®ç°

4. **Chunk ä¾èµ–å…³ç³»ä½œä¸ºè¡¥å……**
   - parents + children ä¸€èµ·å®ç°
   - å®Œå–„æ•´ä½“ä¾èµ–åˆ†æå›¾æ™¯

5. **å¯é€‰çš„é«˜æˆæœ¬åŠŸèƒ½**
   - brotli_size: ä»…åœ¨æ˜ç¡®éœ€è¦æ—¶å¯ç”¨
   - license: ä½œä¸ºå¯é€‰åŠŸèƒ½ï¼Œé»˜è®¤å…³é—­
